[general]
static=yes
writeprotect=no
autofallthrough=yes
priorityjumping=no
extenpatternmatchnew=yes

[globals]
OPERATOR=1000    ; Main receptionist number
VMCHECK=8000     ; Number to check voicemail

; Main context for internal calls
[internal]
; IVR entry point - accessible via extension 9000
exten => 9000,1,Answer()
exten => 9000,n,Wait(1)
exten => 9000,n,Playback(dir-welcome)
exten => 9000,n,Background(main-menu)
exten => 9000,n,WaitExten(10)

; IVR options
exten => 1,1,Goto(reception,s,1)     ; For Reception
exten => 2,1,Goto(management,s,1)    ; For Management
exten => 3,1,Goto(hr,s,1)            ; For Human Resources
exten => 4,1,Goto(production,s,1)    ; For Production
exten => 5,1,Goto(marketing,s,1)     ; For Marketing
exten => 0,1,Goto(internal,${GLOBAL(OPERATOR)},1)  ; Operator/Reception
exten => t,1,Playback(goodbye)
exten => t,n,Hangup()
exten => i,1,Playback(invalid-option)
exten => i,n,Goto(internal,9000,1)

; Voicemail check extension
exten => ${VMCHECK},1,Answer()
exten => ${VMCHECK},n,VoiceMailMain(@voicemail)
exten => ${VMCHECK},n,Hangup()

; Send to voicemail directly without ringing
exten => _*1XXX,1,Answer()
exten => _*1XXX,n,VoiceMail(${EXTEN:1}@voicemail,u)
exten => _*1XXX,n,Hangup()

exten => _*2XXX,1,Answer()
exten => _*2XXX,n,VoiceMail(${EXTEN:1}@voicemail,u)
exten => _*2XXX,n,Hangup()

exten => _*3XXX,1,Answer()
exten => _*3XXX,n,VoiceMail(${EXTEN:1}@voicemail,u)
exten => _*3XXX,n,Hangup()

exten => _*4XXX,1,Answer()
exten => _*4XXX,n,VoiceMail(${EXTEN:1}@voicemail,u)
exten => _*4XXX,n,Hangup()

exten => _*5XXX,1,Answer()
exten => _*5XXX,n,VoiceMail(${EXTEN:1}@voicemail,u)
exten => _*5XXX,n,Hangup()

; Define dial patterns for each department with fallback to voicemail
; Reception Department (1XXX)
exten => _1XXX,1,Answer()
exten => _1XXX,n,Set(CALLERID(name)=${CALLERID(name)})
exten => _1XXX,n,Dial(PJSIP/${EXTEN},20,m)
exten => _1XXX,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
exten => _1XXX,n(busy),VoiceMail(${EXTEN}@voicemail,b)
exten => _1XXX,n,Hangup()
exten => _1XXX,n(unavail),VoiceMail(${EXTEN}@voicemail,u)
exten => _1XXX,n,Hangup()

; Management Department (2XXX)
exten => _2XXX,1,Answer()
exten => _2XXX,n,Set(CALLERID(name)=${CALLERID(name)})
exten => _2XXX,n,Dial(PJSIP/${EXTEN},20,m)
exten => _2XXX,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
exten => _2XXX,n(busy),VoiceMail(${EXTEN}@voicemail,b)
exten => _2XXX,n,Hangup()
exten => _2XXX,n(unavail),VoiceMail(${EXTEN}@voicemail,u)
exten => _2XXX,n,Hangup()

; Human Resources Department (3XXX)
exten => _3XXX,1,Answer()
exten => _3XXX,n,Set(CALLERID(name)=${CALLERID(name)})
exten => _3XXX,n,Dial(PJSIP/${EXTEN},20,m)
exten => _3XXX,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
exten => _3XXX,n(busy),VoiceMail(${EXTEN}@voicemail,b)
exten => _3XXX,n,Hangup()
exten => _3XXX,n(unavail),VoiceMail(${EXTEN}@voicemail,u)
exten => _3XXX,n,Hangup()

; Production Department (4XXX)
exten => _4XXX,1,Answer()
exten => _4XXX,n,Set(CALLERID(name)=${CALLERID(name)})
exten => _4XXX,n,Dial(PJSIP/${EXTEN},20,m)
exten => _4XXX,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
exten => _4XXX,n(busy),VoiceMail(${EXTEN}@voicemail,b)
exten => _4XXX,n,Hangup()
exten => _4XXX,n(unavail),VoiceMail(${EXTEN}@voicemail,u)
exten => _4XXX,n,Hangup()

; Marketing Department (5XXX)
exten => _5XXX,1,Answer()
exten => _5XXX,n,Set(CALLERID(name)=${CALLERID(name)})
exten => _5XXX,n,Dial(PJSIP/${EXTEN},20,m)
exten => _5XXX,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
exten => _5XXX,n(busy),VoiceMail(${EXTEN}@voicemail,b)
exten => _5XXX,n,Hangup()
exten => _5XXX,n(unavail),VoiceMail(${EXTEN}@voicemail,u)
exten => _5XXX,n,Hangup()

; Keep original extensions for compatibility
exten => 100,1,Answer()
exten => 100,n,Dial(PJSIP/100,20,m)
exten => 100,n,VoiceMail(100@voicemail,u)
exten => 100,n,Hangup()

exten => 200,1,Answer()
exten => 200,n,Dial(PJSIP/200,20,m)
exten => 200,n,VoiceMail(200@voicemail,u)
exten => 200,n,Hangup()

; Department contexts for IVR
[reception]
exten => s,1,Background(reception-menu)
exten => s,n,WaitExten(5)
exten => 0,1,Goto(internal,1000,1)   ; Main receptionist
exten => 1,1,Goto(internal,1001,1)   ; Secondary receptionist
exten => t,1,Goto(internal,1000,1)
exten => i,1,Playback(invalid-option)
exten => i,n,Goto(s,1)

[management]
exten => s,1,Background(management-menu)
exten => s,n,WaitExten(5)
exten => 0,1,Goto(internal,2000,1)   ; Department head
exten => 1,1,Goto(internal,2001,1)   ; Assistant manager
exten => t,1,Goto(internal,2000,1)
exten => i,1,Playback(invalid-option)
exten => i,n,Goto(s,1)

[hr]
exten => s,1,Background(hr-menu)
exten => s,n,WaitExten(5)
exten => 0,1,Goto(internal,3000,1)   ; HR Manager
exten => 1,1,Goto(internal,3001,1)   ; HR Assistant
exten => t,1,Goto(internal,3000,1)
exten => i,1,Playback(invalid-option)
exten => i,n,Goto(s,1)

[production]
exten => s,1,Background(production-menu)
exten => s,n,WaitExten(5)
exten => 0,1,Goto(internal,4000,1)   ; Production Manager
exten => 1,1,Goto(internal,4001,1)   ; Production Assistant
exten => t,1,Goto(internal,4000,1)
exten => i,1,Playback(invalid-option)
exten => i,n,Goto(s,1)

[marketing]
exten => s,1,Background(marketing-menu)
exten => s,n,WaitExten(5)
exten => 0,1,Goto(internal,5000,1)   ; Marketing Manager
exten => 1,1,Goto(internal,5001,1)   ; Marketing Assistant
exten => t,1,Goto(internal,5000,1)
exten => i,1,Playback(invalid-option)
exten => i,n,Goto(s,1)
